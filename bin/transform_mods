#!/usr/bin/env ruby
# frozen_string_literal: true

# This script is just for testing and developing the traject configuration. In
# production use fetch_and_import instead
# Example usage:
#   ./bin/transform_mods stanford_tk780vf9050 dlme ./spec/fixtures/mods/stanford.mods

def usage
  $stderr.puts "Usage: #{$PROGRAM_NAME} <identifier> <exhibit slug> <mods file>"
  $stderr.puts 'Please provide a file identifier/path you want to import.'
end

def valid_arguments?
  ARGV.size == 3 && File.exist?(ARGV[2])
end

unless valid_arguments?
  usage
  exit(1)
end

input_file = ARGV[2]
puts 'Loading environment...'
require File.expand_path('../../config/environment', __FILE__)
require 'traject/command_line'
args = ['-c', 'lib/traject/mods_config.rb']

# The Stanford MODS files don't have identifier encoded so pass it in.
args << '-s' << "identifier=#{ARGV[0]}"
args << '-s' << "exhibit_slug=#{ARGV[1]}"
args << input_file

cmdline = Traject::CommandLine.new(args)
result = cmdline.execute

exit 1 unless result # non-zero exit status on process telling us there's problems.
